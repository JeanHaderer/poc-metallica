workflows:
- name: GeneratePasswordAndSendMail
  steps:
  - label: "generate password"
    id: "0f691401-2e9b-4673-ba48-b38dc55c8fb1"
    limit: 20
    limitKey: PasswordService
    type: Http
    metadatas:
      url: "${env.urls['password-generator']}/generate-password"
      username: "${context.username}"
    payloadTemplate: |
      {
        "url": "${metadatas.url}",
        "body": { "username": "${metadatas.username}" },
        "method\": \"POST\"
      }
    
  - label: "Add generated to context"
    id: "9f397ae6-6ae5-4b29-bde4-4f52710eea63"
    type: EnrichContextProcessor
    metadatas: 
      password: "${context.previousResult.password}"
    payloadTemplate: |
      {"password": "${metadatas.password}"}
    
  - label: "generate password"
    id: "42f74465-baf2-4605-8e1e-b3141af0a446"
    type: Http
    metadatas: 
      url: "${env.urls['send-mail']}/send-mail"
      username: "${context.username}"
      password: "${context.password}"
      method: "POST"
    payloadTemplate: |
      {
       "url": "${metadatas.url}",
       "body": { "username": "${metadatas.username}", "password":"${metadatas.password}" },
       "method": "${metadatas.method}"
      }
